---
description: AI 辅助开发的核心规范，用于避免架构碎化、代码不可维护、幻觉等常见问题。
alwaysApply: true
---

# 全局 AI 开发规范 (AI Development Guidelines)

为了避免全盘 AI 开发带来的架构碎化、代码不可维护、幻觉等常见问题，作为 AI 开发助手，在处理本项目的任何任务（Go 后端 & Flutter 前端）时，你必须严格遵循以下规范：

## 1. 架构与全局视野优先 (Architecture First)

- **拒绝重复造轮子：** 在编写新功能前，必须先搜索项目中已有的类似实现、通用工具类（Utils）、全局状态管理和现有模型结构。
- **保持风格一致：** 严格遵循现有的代码目录结构和命名规范，不要擅自引入与当前项目（Flutter / Go）已有模式不符的设计。
- **目录设计原则（详见 README 目录设计）：**
  - 模块化 + 公共层：业务放 `module/`，基础设施放 `pub/`
  - 目录即上下文：模块内用层名（`handler.go`、`service.go`、`data.go`），不重复资源前缀
  - Handler → Service → Data 分层
  - pub 内跨模块文件用 `资源_层`（如 `shot_image_service.go`）

## 2. 拒绝幻觉与严谨依赖 (No Hallucinations)

- **验证 API 真实性：** 坚决不“猜”第三方库的方法！如果对特定库的 API 或版本不确定，主动阅读其源码定义，或通过网络搜索/官方文档验证，切勿随意捏造不存在的属性。
- **谨慎处理依赖版本：** 除非用户明确要求，否则绝对不要修改 `go.mod` 或 `pubspec.yaml` 中现有的依赖库版本，以避免引发版本冲突问题。

## 3. 防御性编程与边缘情况 (Defensive Programming)

- **处理“非快乐路径”：** 编写业务逻辑时，必须主动处理各种边缘情况（如：空值/Null、网络超时、数据库查询为空、无效输入、并发写冲突）。
- **完善错误追踪：** 不要写空的 `catch` / `recover` 块。所有异常必须能够被正确抛出、返回到前端，并在后台或控制台留下带有上下文的有效错误日志。
  
## 4. 安全第一 (Security & Privacy)

- **严禁硬编码敏感信息：** API Key、密码、密钥等数据必须通过配置文件或环境变量加载，决不允许明文写在代码内。
- **防范常见攻击：** 确保后端的 SQL 查询防范注入（使用 GORM 等 ORM 或参数化查询），接口注意鉴权与越权访问控制。

## 5. 性能与资源意识 (Performance Optimization)

- **Go 后端：** 避免 Goroutine 泄漏（需合理控制 Context/超时），注意大批量数据查询时的内存占用，防范数据库 N+1 查询问题。
- **Flutter 前端：** 避免不必要的 Widget 重建（Rebuild），合理使用 `const` 构造函数，注意列表或图片加载的内存占用与回收。

## 6. 小步迭代与可维护性 (Maintainability)

- **代码即文档：** 提供自解释性的变量名和函数名。只注释“为什么”这么做，而不是“是什么”。
- **注释使用中文：** 生成代码时，为公开函数、复杂逻辑、业务分支等添加适当的中文注释，便于团队阅读与维护。
- **克制打补丁：** 如果发现原有代码结构异常混乱，不要通过无限嵌套 `if/else` 来实现新功能，必须提醒用户重构逻辑后再进行开发。
- **人类可读性：** 保证你生成的每一行代码对于人类开发者来说都是清晰、易读的。绝对不可生成大段难以拆解的混淆逻辑。

## 7. 每个文件代码行数控制在600以内
